\section{Introduction}

As of 2016, more than 54\% of the worldâ€™s population live in urban areas, and the percentage is expected to increase to 66 by 2050~\cite{nations2014world}. In the meantime, increasing amount of urban data are being accumulated in the digital form, such as human traces, traffic, venues, local events, etc. Many cities (e.g., New York City, Chicago, and Los Angeles) have joined the open data initiative and created websites to release the city data to the public~\cite{data-taxi, nyctaxi}. Analyzing such data could provide us with valuable insights into our urban dynamics, and make the city smarter.

In this paper, we are interested in a typical inference problem, which aims to infer a regional property (i.e. crime rate, personal income, and real estate price) from observed auxiliary urban features. Such inference can help us better understand the correlations among urban properties. Recent work~\cite{wang2016crime} has shown that the taxi volume could be used as a similarity measure between regions. Through the similarity measure from traffic flows, we are able to employ the target variable of relevant regions to improve the predication accuracy. The intuition is that a large volume of flow from region A to region B indicates that the properties of A and B should be more relevant, and thus we could use one to predict the other. Although the intuition seems straightforward, there are some issues with it. Consider the example in Figure~\ref{fig:example}. On the left, there is no significant flow between two solid blue circles. However, since they share a lot of common neighbors, it is reasonable to assume they are relevant. On the right, the solid blue circle is a hub with strong connections to other regions. However, the hub could be a downtown area and play a different role compared with other regions.

\vspace{-4mm}
\begin{figure}[h]
\centering
\includegraphics[width=0.5\linewidth]{fig/example.pdf}
\vspace{-3mm}
\caption{Each node is a region. The edge represents a significant amount of taxi flow between two regions.}
\label{fig:example}
\end{figure}
\vspace{-4mm}

The example above motivates us to account for the structural information of mobility flow graph. Graph embedding method~\cite{perozzi2014deepwalk,tang2015line} can be one possible solution to model such structural information. A good region representation learned from mobility flow graph may help us better capture the relationships between regions and thus the correlations can be used to improve the inference model.

However, utilizing  taxi flow data to learn the representations of regions is non-trivial. In literature, a transition matrix has been frequently used to represent mobility flow data~\cite{qi2011measuring, pan2013land, zheng2013u, zheng2014diagnosing}.  In this transition matrix, a region $i$ can be represented by an $n$-dimensional vector, where the $j$-th element in the vector indicates the traffic volume from region $i$ to $j$ (out flow) or from region $j$ to region $i$ (in flow). However, such a representation does not consider the temporal dynamics. 
For example, the flow volume from region $A$ to downtown might be the same as that from region $B$ to downtown. Without considering the temporal dynamics, we cannot differentiate $A$ and $B$ w.r.t. downtown. However, the flow from $A$ to downtown might mostly be morning transitions whereas the flow from $B$ to downtown happens in the evenings. Downtown region might function as a working place for people living in Region $A$ but function as an after-work entertainment region for people working in region $B$. 
So $A$ and $B$ should be different in their presentations since they have different relationships with downtown region.


To consider the temporal dynamics, we could  construct a tensor by adding a time dimension in addition to the transition matrix~\cite{yuan2012discovering}.  However, such a tensor does not capture the multi-hop transitions between regions. For example, there could be strong flow from residential area $A$ to working area $B$ in the morning, and then from working area $B$ to restaurant area $C$ in the evening.  This indirect transition relationship between the region $A$ and $C$ cannot be captured in the pairwise transition matrix. 

We propose to learn representations of regions by adapting recent embedding techniques, which have demonstrated successful results in word embedding~\cite{mikolov2013distributed, mikolov2013efficient, mikolov2013linguistic, pennington2014glove} and graph embedding~\cite{perozzi2014deepwalk, tang2015line, grovernode2vec}. However, the mobility flow data input are quite different from those data. The key challenge lies in how to generate a meaningful context for a region using the mobility flow data, in a similar way to the sentence context for word embedding or the neighbor context for graph embedding. Another challenge lies in the data sparsity. Even though we have a huge mobility dataset, the data follow a long-tail distribution w.r.t. regions. We could still have no information for some remote regions at certain times such as midnight, and thus it is difficult to learn their corresponding representations.

We propose a region embedding method by considering both temporal dynamics and  multi-hop transitions. We define a flow graph, where each vertex represents one region within a certain time interval and edges represent the transition flow between two regions at different time intervals. The structure encodes both temporal dynamics and multi-hop transitions. To further address the sparsity issue, we define a spatial graph, and learn the embedding jointly on the flow graph and the spatial graph. The spatial graph captures the geographical adjacency among regions and complements the flow graph.

In experiment, we evaluate our embedding methods on three prediction tasks. The proposed embedding method is shown to consistently outperform existing methods. In order to interpret the semantic meaning of learned embeddings, we conduct a quantitative analysis on taxi and POI data, and also give a case study on the embedding visualizations.

To summarize, the key contributions of this paper are:
\begin{itemize}[leftmargin=*]
\item We study a generalized inference problem in the urban setting. We propose to learn region embedding from mobility flow data to enhance the inference model.
\item In order to incorporate both temporal dynamics and multi-hop transition and also to address the sparsity issue, we propose to jointly learn the embedding from the flow graph and the spatial graph. 
\item We validate our method through extensive experiments on multiple datasets.
\end{itemize}

The rest of this paper is organized as follows. Section \ref{sec:prel} gives the motivation of learning region embeddings. Section \ref{sec:definition} presents the formal definition of our problem. Section \ref{sec:method} introduces the dynamic embedding method in detail. The experiment results are given in Section \ref{sec:experiments}. Section \ref{sec:related} summarizes related work. Finally, we conclude in Section \ref{sec:conclusion}.